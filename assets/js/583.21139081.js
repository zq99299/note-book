(window.webpackJsonp=window.webpackJsonp||[]).push([[583],{2094:function(s,a,e){"use strict";e.r(a);var t=e(13),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"学习-k8s-的基础知识"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#学习-k8s-的基础知识"}},[s._v("#")]),s._v(" 学习 k8s 的基础知识")]),s._v(" "),e("p",[s._v("此笔记详细参考：https://kubernetes.io/zh/docs/tutorials/kubernetes-basics/")]),s._v(" "),e("h2",{attrs:{id:"部署应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署应用"}},[s._v("#")]),s._v(" 部署应用")]),s._v(" "),e("h3",{attrs:{id:"k8s-部署"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#k8s-部署"}},[s._v("#")]),s._v(" k8s 部署")]),s._v(" "),e("p",[s._v("一旦运行了 Kubernetes 集群，就可以在其上部署容器化应用程序。 为此，您需要创建 Kubernetes "),e("strong",[s._v("Deployment")]),s._v(" 配置。Deployment 指挥 Kubernetes 如何创建和更新应用程序的实例。创建 Deployment 后，Kubernetes master 将应用程序实例调度到集群中的各个节点上。")]),s._v(" "),e("h3",{attrs:{id:"使用-kubectl-创建-deployment"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用-kubectl-创建-deployment"}},[s._v("#")]),s._v(" 使用 kubectl 创建 Deployment")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 client 和 server 版本")]),s._v("\nkubectl version\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看集群中的节点")]),s._v("\n$ kubectl get nodes\nNAME       STATUS   ROLES    AGE   VERSION\nminikube   Ready    master   85s   v1.17.3\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建应用")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 需要应用名称 和完整的 image 地址")]),s._v("\n$ kubectl create deployment kubernetes-bootcamp --image"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("gcr.io/google-samples/kubernetes-bootcamp:v1\ndeployment.apps/kubernetes-bootcamp created\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取你的应用，可以看到有一个应用，运行在一个节点上")]),s._v("\n$ kubectl get deployments\nNAME                  READY   UP-TO-DATE   AVAILABLE   AGE\nkubernetes-bootcamp   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           114s\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此时该应用运行在内部的一个 pods：一个私有的、隔离的网络上，默认情况下，他们可以同同一个 k8s 集群中的其他 pods 和 services看到，不能在外网上看到")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以通过 kubectl 通过 API 与应用程序进行交互")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以新开一个终端，然后启动一个代理")]),s._v("\n$ kubectl proxy\nStarting to serve on "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:8001\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 现在终端和 k8s 集群之间有了链接，可以通过代理之间访问 API")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 比如可以通过代理访问 version 信息")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://localhost:8001/version\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"major"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"minor"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"17"')]),s._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gitVersion"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v1.17.3"')]),s._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gitCommit"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"06ad960bfd03b39c8310aaf92d1e7c12ce618213"')]),s._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gitTreeState"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"clean"')]),s._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"buildDate"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2020-02-11T18:07:13Z"')]),s._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"goVersion"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"go1.13.6"')]),s._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"compiler"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gc"')]),s._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"platform"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"linux/amd64"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# API 服务器将根据 pod 名称为每个 pod 自动创建一个断点，该端点也可以通过代理访问，首先要获得断点的名称")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下面把获得的断点名称放到 POD_NAME 的环境变量中")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意：通过 kubectl get pods 能看到所有的 pod 的端点名称；后面这个看效果是直接获取到了一个 name")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("POD_NAME")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get pods -o go-template --template "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{range .items}}{{.metadata.name}}{{\""),e("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("\"}}{{end}}'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" Name of the Pod: "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$POD_NAME")]),s._v("\nName of the Pod: kubernetes-bootcamp-69fbc6f4cf-ppc9j\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 后续会用到该知识点")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br")])]),e("h2",{attrs:{id:"了解你的应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#了解你的应用"}},[s._v("#")]),s._v(" 了解你的应用")]),s._v(" "),e("h3",{attrs:{id:"目标"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#目标"}},[s._v("#")]),s._v(" 目标")]),s._v(" "),e("ul",[e("li",[s._v("了解 Kubernetes Pod。")]),s._v(" "),e("li",[s._v("了解 Kubernetes 工作节点。")]),s._v(" "),e("li",[s._v("对已部署的应用故障排除。")])]),s._v(" "),e("h3",{attrs:{id:"查看-pod-和工作节点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看-pod-和工作节点"}},[s._v("#")]),s._v(" 查看 pod 和工作节点")]),s._v(" "),e("h4",{attrs:{id:"kubernetes-pods"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes-pods"}},[s._v("#")]),s._v(" Kubernetes Pods")]),s._v(" "),e("p",[e("strong",[s._v("Pod")]),s._v(" 托管你的应用实例。Pod 是 Kubernetes 抽象出来的，表示一组一个或多个应用程序容器（如 Docker 或 rkt ），以及这些容器的一些共享资源。这些资源包括:")]),s._v(" "),e("ul",[e("li",[s._v("共享存储，当作卷")]),s._v(" "),e("li",[s._v("网络，作为唯一的集群 IP 地址")]),s._v(" "),e("li",[s._v("有关每个容器如何运行的信息，例如容器映像版本或要使用的特定端口。")])]),s._v(" "),e("h4",{attrs:{id:"工作节点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#工作节点"}},[s._v("#")]),s._v(" 工作节点")]),s._v(" "),e("p",[s._v("一个 pod 总是运行在 "),e("strong",[s._v("工作节点")]),s._v("。工作节点是 Kubernetes 中的参与计算的机器，可以是虚拟机或物理计算机，具体取决于集群。每个工作节点由主节点管理。工作节点可以有多个 pod ，Kubernetes 主节点会自动处理在群集中的工作节点上调度 pod 。 主节点的自动调度考量了每个工作节点上的可用资源。")]),s._v(" "),e("p",[s._v("每个 Kubernetes 工作节点至少运行:")]),s._v(" "),e("ul",[e("li",[s._v("Kubelet，负责 Kubernetes 主节点和工作节点之间通信的过程; 它管理 Pod 和机器上运行的容器。")]),s._v(" "),e("li",[s._v("容器运行时（如 Docker ，rkt ）负责从仓库中提取容器镜像，解压缩容器以及运行应用程序。")])]),s._v(" "),e("p",[e("em",[s._v("如果它们紧耦合并且需要共享磁盘等资源，这些容器应在一个 Pod 中编排。")])]),s._v(" "),e("h3",{attrs:{id:"使用-kubectl-进行故障排除"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用-kubectl-进行故障排除"}},[s._v("#")]),s._v(" 使用 kubectl 进行故障排除")]),s._v(" "),e("ul",[e("li",[s._v("kubectl get - 列出资源")]),s._v(" "),e("li",[s._v("kubectl describe - 显示有关资源的详细信息")]),s._v(" "),e("li",[s._v("kubectl logs - 打印 pod 和其中容器的日志")]),s._v(" "),e("li",[s._v("kubectl exec - 在 pod 中的容器上执行命令")])]),s._v(" "),e("h4",{attrs:{id:"检查应用程序配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#检查应用程序配置"}},[s._v("#")]),s._v(" 检查应用程序配置")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查现有的 pod")]),s._v("\n$ kubectl get pods\nNAME                                   READY   STATUS    RESTARTS   AGE\nkubernetes-bootcamp-765bf4c7b4-nw2d8   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          35s\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以查看该 pod 内的 容器和镜像 等信息")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以看到返回的信息数据很多")]),s._v("\n$ kubectl describe pods\nName:         kubernetes-bootcamp-765bf4c7b4-nw2d8\nNamespace:    default\nPriority:     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nNode:         minikube/172.17.0.13\nStart Time:   Wed, 08 Apr "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" 03:16:46 +0000\nLabels:       pod-template-hash"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("765bf4c7b4\n              "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("run")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes-bootcamp\nAnnotations:  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nStatus:       Running\nIP:           "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.6\nIPs:\n  IP:           "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.6\nControlled By:  ReplicaSet/kubernetes-bootcamp-765bf4c7b4\nContainers:\n  kubernetes-bootcamp:\n    Container ID:   docker://3854a4a1e21d6c8e192e8121d9c07b7e03fe8fb90e3f3dfaa66b4185ba395735\n    Image:          gcr.io/google-samples/kubernetes-bootcamp:v1\n    Image ID:       docker-pullable://jocatalin/kubernetes-bootcamp@sha256:0d6b8ee63bb57c5f5b6156f446b3bc3b3c143d233037f3a2f00e279c8fcc64af\n    Port:           "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/TCP\n    Host Port:      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/TCP\n    State:          Running\n      Started:      Wed, 08 Apr "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" 03:16:52 +0000\n    Ready:          True\n    Restart Count:  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    Environment:    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    Mounts:\n      /var/run/secrets/kubernetes.io/serviceaccount from default-token-h8pmg "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ro"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nConditions:\n  Type              Status\n  Initialized       True\n  Ready             True\n  ContainersReady   True\n  PodScheduled      True\nVolumes:\n  default-token-h8pmg:\n    Type:        Secret "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a volume populated by a Secret"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    SecretName:  default-token-h8pmg\n    Optional:    "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\nQoS Class:       BestEffort\nNode-Selectors:  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nTolerations:     node.kubernetes.io/not-ready:NoExecute "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" 300s\n                 node.kubernetes.io/unreachable:NoExecute "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" 300s\nEvents:\n  Type     Reason            Age                  From               Message\n  ----     ------            ----                 ----               -------\n  Warning  FailedScheduling  105s "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x3 over 110s"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  default-scheduler  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1 nodes are available: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" node"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" had taints that the pod didnt tolerate.\n  Normal   Scheduled         102s                 default-scheduler  Successfully assigned default/kubernetes-bootcamp-765bf4c7b4-nw2d8 to minikube\n  Normal   Pulled            97s                  kubelet, minikube  Container image "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gcr.io/google-samples/kubernetes-bootcamp:v1"')]),s._v(" already present on machine\n  Normal   Created           97s                  kubelet, minikube  Created container kubernetes-bootcamp\n  Normal   Started           96s                  kubelet, minikube  Started container kubernetes-bootcamp\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 该命令输出的信息是人类可读的，并非是脚本化的原始文件  ")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br")])]),e("h4",{attrs:{id:"在终端中显示应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在终端中显示应用"}},[s._v("#")]),s._v(" 在终端中显示应用")]),s._v(" "),e("p",[s._v("pods 是在私有网络中运行的，因此先创建一个代理")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ kubectl proxy\nStarting to serve on "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:8001\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取 pod 名称，并存储在变量中")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("POD_NAME")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get pods -o go-template --template "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{range .items}}{{.metadata.name}}{{\""),e("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("\"}}{{end}}'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" Name of the Pod: "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$POD_NAME")]),s._v("\nName of the Pod: kubernetes-bootcamp-765bf4c7b4-nw2d8\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过 API 获取该 POD 的信息")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://localhost:8001/api/v1/namespaces/default/pods/"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$POD_NAME")]),s._v("/proxy/\nHello Kubernetes bootcamp"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Running on: kubernetes-bootcamp-765bf4c7b4-nw2d8 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("v")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("h4",{attrs:{id:"显示容器日志"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#显示容器日志"}},[s._v("#")]),s._v(" 显示容器日志")]),s._v(" "),e("p",[s._v("应用程序发送到 STDOUT 的任何内容都会成为 pod 中容器的日志。")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看该 POD 的容器日志")]),s._v("\n$ kubectl logs "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$POD_NAME")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h4",{attrs:{id:"在容器上执行命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在容器上执行命令"}},[s._v("#")]),s._v(" 在容器上执行命令")]),s._v(" "),e("p",[s._v("一旦 Pod 启动并运行，我们就可以直接在容器上执行命令。为此，我们使用 exec 命令并使用 Pod 的名称作为参数。让我们列出环境变量:")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ kubectl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$POD_NAME")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("env")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("HOSTNAME")])]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes-bootcamp-765bf4c7b4-nw2d8\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBERNETES_PORT_443_TCP_ADDR")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBERNETES_SERVICE_HOST")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("在 Pod 的容器中启动一个 bash 程序。注意的是：由于当前 pod 只有一个容器，容器名称是可以省略的")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ kubectl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -ti "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$POD_NAME")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\nroot@kubernetes-bootcamp-765bf4c7b4-nw2d8:/"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这就进入了一个 pod 内的容器")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在该 bash 环境下，可以执行 bash 指令，比如 ls 等")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 看看这个 js 中的内容。里面就是我们部署容器的时候运行的一个 node js 程序，他监听了 8080 端口，并输出一些信息")]),s._v("\nroot@kubernetes-bootcamp-765bf4c7b4-nw2d8:/"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat server.js")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 由于在容器内部，所以可以直接访问 localhost")]),s._v("\nroot@kubernetes-bootcamp-765bf4c7b4-nw2d8:/"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl localhost:8080")]),s._v("\nHello Kubernetes bootcamp"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Running on: kubernetes-bootcamp-765bf4c7b4-nw2d8 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("v")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 退出与该容器的联机")]),s._v("\nroot@kubernetes-bootcamp-765bf4c7b4-nw2d8:/"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# exit")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("h2",{attrs:{id:"公开的暴露你的应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#公开的暴露你的应用"}},[s._v("#")]),s._v(" 公开的暴露你的应用")]),s._v(" "),e("h3",{attrs:{id:"目标-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#目标-2"}},[s._v("#")]),s._v(" 目标")]),s._v(" "),e("ul",[e("li",[s._v("了解 Kubernetes 中的服务")]),s._v(" "),e("li",[s._v("了解标签和 LabelSelector 对象如何与服务相关")]),s._v(" "),e("li",[s._v("使用服务在 Kubernetes 集群外公开应用程序")])]),s._v(" "),e("h3",{attrs:{id:"服务概述"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#服务概述"}},[s._v("#")]),s._v(" 服务概述")]),s._v(" "),e("p",[s._v("Pod 是有生命周期的，当工作节点死亡，在该节点上运行的 Pod 也会丢失，然后可能会通过 ReplicaSet 来创建新的 Pod 来恢复成原来的状态。")]),s._v(" "),e("p",[s._v("集群中的每个 Pod 都有一个唯一的 IP 地址，因此需要一种自动协调 Pod 之间的方法")]),s._v(" "),e("p",[s._v("Kubernetes 中的服务是一种抽象，定义了 Pod 的逻辑集合和访问 Pod 的策略，可以通过 YML（首选）或 JSON 定义服务。如果没有服务，尽管每个 Pod 有 一个唯一的地址，但是也不会暴露在集群外部。服务允许你的应用程序接受流量。")]),s._v(" "),e("p",[s._v("在 ServiceSpec 中通过 type 可以指定以何种方式公开服务：")]),s._v(" "),e("ul",[e("li",[e("em",[s._v("ClusterIP")]),s._v("（默认）：在群集的内部 IP上公开服务。这种类型使得只能从群集内部访问服务。")]),s._v(" "),e("li",[e("em",[s._v("NodePort")]),s._v("：使用 NAT 在群集中每个选定节点的相同端口上公开服务。使用可以从群集外部访问服务"),e("code",[s._v(":")]),s._v("。"),e("code",[s._v("<NodeIP>:<NodePort>")]),s._v("  ClusterIP 的超集。")]),s._v(" "),e("li",[e("em",[s._v("LoadBalancer")]),s._v(" ：在当前云中创建一个外部负载平衡器（如果支持），并为该服务分配一个固定的外部 IP。NodePort 的超集。")]),s._v(" "),e("li",[e("em",[s._v("ExternalName")]),s._v("："),e("code",[s._v("externalName")]),s._v("通过返回带有该名称的 CNAME 记录，使用任意名称（在规范中指定）公开服务。不使用代理。此类型需要 v1.7 或更高版本 "),e("code",[s._v("kube-dns")]),s._v("。")])]),s._v(" "),e("p",[s._v("服务在一组 Pod 之间路由流量。服务是允许 Pod 在 Kubernetes 中死亡和复制而又不影响您的应用程序的抽象。")]),s._v(" "),e("p",[s._v("简单说：服务类似一个 nginx，可以决定路由到哪些 pod 上去")]),s._v(" "),e("h3",{attrs:{id:"使用-expose-暴露你的程序"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用-expose-暴露你的程序"}},[s._v("#")]),s._v(" 使用 expose 暴露你的程序")]),s._v(" "),e("h4",{attrs:{id:"创建新服务-services"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建新服务-services"}},[s._v("#")]),s._v(" 创建新服务 services")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 先找到一个 pod ，确定你的应用还在运行")]),s._v("\n$ kubectl get pods\nNAME                                   READY   STATUS    RESTARTS   AGE\nkubernetes-bootcamp-765bf4c7b4-bsmcs   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2m19s\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出集群中的服务")]),s._v("\n$ kubectl get services\nNAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   AGE\nkubernetes   ClusterIP   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("/TCP   2m57s\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[s._v("上述有一个 kubernetes 的服务，这个是 minikube 启动集群时默认创建的。")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关于这个 deployment/kubernetes-bootcamp 前面的 deployment 是我们不熟应用时的指令")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果这里使用 services/xxx 一样的概念")]),s._v("\n$ kubectl expose deployment/kubernetes-bootcamp --type"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NodePort"')]),s._v(" --port "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\nservice/kubernetes-bootcamp exposed\n\n$ kubectl get services\nNAME                  TYPE        CLUSTER-IP       EXTERNAL-IP   PORT"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("          AGE\nkubernetes            ClusterIP   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1        "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("/TCP          9m17s\nkubernetes-bootcamp   NodePort    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.104")]),s._v(".184.115   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":31880/TCP   57s\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[s._v("xx")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ kubectl describe services/kubernetes-bootcamp\nName:                     kubernetes-bootcamp\nNamespace:                default\nLabels:                   "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("run")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes-bootcamp\nAnnotations:              "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nSelector:                 "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("run")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes-bootcamp\nType:                     NodePort\nIP:                       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.104")]),s._v(".184.115\nPort:                     "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("unset"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/TCP\nTargetPort:               "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/TCP\nNodePort:                 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("unset"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("31880")]),s._v("/TCP\nEndpoints:                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.3:8080\nSession Affinity:         None\nExternal Traffic Policy:  Cluster\nEvents:                   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个是暴露的端口，")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NODE_PORT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get services/kubernetes-bootcamp -o go-template"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{(index .spec.ports 0).nodePort}}'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NODE_PORT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NODE_PORT")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NODE_PORT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("31880")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 但是这个 ip 结果居然是 172.17.0.49 也就是 kubernetes 暴露的 IP")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("minikube "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NODE_PORT")]),s._v("\nHello Kubernetes bootcamp"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Running on: kubernetes-bootcamp-765bf4c7b4-bsmcs "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("v")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br")])]),e("h4",{attrs:{id:"使用标签-labels"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用标签-labels"}},[s._v("#")]),s._v(" 使用标签 labels")]),s._v(" "),e("p",[s._v("deployment 为 pod 自动创建了一个标签")]),s._v(" "),e("div",{staticClass:"language-baSH line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过描述来获取标签信息")]),s._v("\n$ kubectl describe deployment\nName:                   kubernetes-bootcamp\nNamespace:              default\nCreationTimestamp:      Wed, 08 Apr "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" 05:23:49 +0000\nLabels:                 "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("run")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes-bootcamp\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("可以通过这个标签来获取 pod 列表，通过 "),e("code",[s._v("-l")]),s._v(" 参数")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ kubectl get pods -l "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("run")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes-bootcamp\nNAME                                   READY   STATUS    RESTARTS   AGE\nkubernetes-bootcamp-765bf4c7b4-bsmcs   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          24m\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("还可以用标签来获取服务")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ kubectl get services -l "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("run")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes-bootcamp\nNAME                  TYPE       CLUSTER-IP       EXTERNAL-IP   PORT"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("          AGE\nkubernetes-bootcamp   NodePort   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.104")]),s._v(".184.115   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":31880/TCP   16m\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取 pod name")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("POD_NAME")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get pods -o go-template --template "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{range .items}}{{.metadata.name}}{{\""),e("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("\"}}{{end}}'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" Name of the Pod: "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$POD_NAME")]),s._v("\nName of the Pod: kubernetes-bootcamp-765bf4c7b4-bsmcs\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("给应用添加新标签，使用 label 参数，后面跟 象类型、对象名称和新标签")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ kubectl label pod "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$POD_NAME")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("app")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("v1\npod/kubernetes-bootcamp-765bf4c7b4-bsmcs labeled\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("查看这个 pod 的标签列表")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ kubectl describe pods "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$POD_NAME")]),s._v("\nName:         kubernetes-bootcamp-765bf4c7b4-bsmcs\nNamespace:    default\nPriority:     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nNode:         minikube/172.17.0.49\nStart Time:   Wed, 08 Apr "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" 05:24:06 +0000\nLabels:       "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("app")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("v1\n              pod-template-hash"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("765bf4c7b4\n              "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("run")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes-bootcamp\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以看到多了 app=v1")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 那么就可以通过标签来获取 pod 列表了")]),s._v("\n$ kubectl get pods -l "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("app")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("v1\nNAME                                   READY   STATUS    RESTARTS   AGE\nkubernetes-bootcamp-765bf4c7b4-bsmcs   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          28m\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br")])]),e("h4",{attrs:{id:"删除服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#删除服务"}},[s._v("#")]),s._v(" 删除服务")]),s._v(" "),e("p",[s._v("可以使用 "),e("code",[s._v("delete service")]),s._v(" 命令，标签也可以在这里使用")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ kubectl delete "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" -l "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("run")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes-bootcamp\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes-bootcamp"')]),s._v(" deleted\n\n$ kubectl get services\nNAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   AGE\nkubernetes   ClusterIP   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("/TCP   30m\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 会发现服务没有了")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用之前的访问地址，发现不能访问了，表示该应用不被暴露在集群之外了")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("minikube "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NODE_PORT")]),s._v("\ncurl: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Failed to connect to "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.49 port "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("31880")]),s._v(": Connection refused\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以通过命令执行，来确认该应用程序还存活")]),s._v("\n$ kubectl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -ti "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$POD_NAME")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" localhost:8080\nHello Kubernetes bootcamp"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Running on: kubernetes-bootcamp-765bf4c7b4-bsmcs "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("v")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br")])]),e("p",[s._v("这里已经看到应用程序确实还活跃，要关闭应用程序的话，需要删除部署，因为部署正在管理应用程序")]),s._v(" "),e("h2",{attrs:{id:"伸缩应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#伸缩应用"}},[s._v("#")]),s._v(" 伸缩应用")]),s._v(" "),e("p",[s._v("在之前的模块中，我们创建了一个 "),e("a",{attrs:{href:"https://kubernetes.io/docs/user-guide/deployments/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Deployment"),e("OutboundLink")],1),s._v("，然后通过 "),e("a",{attrs:{href:"https://kubernetes.io/docs/user-guide/services/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Service"),e("OutboundLink")],1),s._v("让其可以开放访问。Deployment 仅为跑这个应用程序创建了一个 Pod。 当流量增加时，我们需要扩容应用程序满足用户需求。")]),s._v(" "),e("p",[e("strong",[s._v("扩缩")]),s._v(" 是通过改变 Deployment 中的副本数量来实现的。")]),s._v(" "),e("h3",{attrs:{id:"扩展"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#扩展"}},[s._v("#")]),s._v(" 扩展")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 找到我们的部署")]),s._v("\n$ kubectl get deployments\nNAME                  READY   UP-TO-DATE   AVAILABLE   AGE\nkubernetes-bootcamp   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           3m31s\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("列表字段含义：")]),s._v(" "),e("ul",[e("li",[s._v("NAME：集群中 deployment 的名称")]),s._v(" "),e("li",[s._v("READY：当前所需副本的比率")]),s._v(" "),e("li",[s._v("UP-TO-DATE：已更新到所需状态的数量")]),s._v(" "),e("li",[s._v("AVAILABLE：有多少应用程序副本供用户使用")]),s._v(" "),e("li",[s._v("AGE：应用程序运行的时间")])]),s._v(" "),e("p",[s._v("查看 deployment 运行的副本")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ kubectl get rs\nNAME                             DESIRED   CURRENT   READY   AGE\nkubernetes-bootcamp-765bf4c7b4   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       38m\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# DESIRED：部署程序时期望的副本数量")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CURRENT：当前正在运行的副本数量")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("注意：副本集的名称总是格式化为 "),e("code",[s._v("[DEPLOYMENT-NAME]-[RANDOM-STRING]")]),s._v("，随机字符串是随机生成的，使用 "),e("code",[s._v("pod-template-hash")]),s._v(" 作为随机数种子")]),s._v(" "),e("p",[s._v("接下来，我们将部署扩展到 4 个副本。使用 "),e("code",[s._v("kubectl scale")]),s._v(" 命令")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 部署类型/应用名称 所需要的数量")]),s._v("\n$ kubectl scale deployments/kubernetes-bootcamp --replicas"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\ndeployment.apps/kubernetes-bootcamp scaled\n\n$ kubectl get deployments\nNAME                  READY   UP-TO-DATE   AVAILABLE   AGE\nkubernetes-bootcamp   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("/4     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           45m\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 pod 的数量")]),s._v("\n$ kubectl get pods -o wide\nNAME                                   READY   STATUS    RESTARTS   AGE   IP           NODE       NOMINATED NODE   READINESS GATES\nkubernetes-bootcamp-765bf4c7b4-kvzml   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          45m   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.2   minikube   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nkubernetes-bootcamp-765bf4c7b4-mc5sl   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          67s   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.8   minikube   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nkubernetes-bootcamp-765bf4c7b4-rcfbm   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          67s   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.9   minikube   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nkubernetes-bootcamp-765bf4c7b4-tphzj   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          67s   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.7   minikube   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br")])]),e("p",[s._v("现在有 4 个 pod，有不同的 IP 地址。这个更改已经注册到 Deployment events log 中，可以通过以下命令验证")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ kubectl describe deployments/kubernetes-bootcamp\nName:                   kubernetes-bootcamp\nNamespace:              default\nCreationTimestamp:      Wed, 08 Apr "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" 06:14:57 +0000\nLabels:                 "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("run")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes-bootcamp\nAnnotations:            deployment.kubernetes.io/revision: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nSelector:               "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("run")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes-bootcamp\nReplicas:               "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" desired "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" updated "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" total "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" available "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" unavailable\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(" 看到有 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 个副本\nEvents:\n  Type    Reason             Age    From                   Message\n  ----    ------             ----   ----                   -------\n  Normal  ScalingReplicaSet  47m    deployment-controller  Scaled up replica "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" kubernetes-bootcamp-765bf4c7b4 to "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  Normal  ScalingReplicaSet  3m15s  deployment-controller  Scaled up replica "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" kubernetes-bootcamp-765bf4c7b4 to "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 另外，在 events 中，有一条日志是变成了 4 个  ")]),s._v("\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br")])]),e("h3",{attrs:{id:"负载均衡-load-balancing"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡-load-balancing"}},[s._v("#")]),s._v(" 负载均衡 Load Balancing")]),s._v(" "),e("p",[s._v("让我们检查服务是否在负载平衡流量。为了找出暴露的 IP 和端口，我们可以使用前面模块中学习到的 describe 服务:")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ kubectl describe services/kubernetes-bootcamp\nName:                     kubernetes-bootcamp\nNamespace:                default\nLabels:                   "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("run")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes-bootcamp\nAnnotations:              "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nSelector:                 "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("run")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes-bootcamp\nType:                     NodePort\nIP:                       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".156.129\nPort:                     "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("unset"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/TCP\nTargetPort:               "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/TCP\nNodePort:                 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("unset"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("31244")]),s._v("/TCP\nEndpoints:                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.2:8080,172.18.0.7:8080,172.18.0.8:8080 + "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" more"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nSession Affinity:         None\nExternal Traffic Policy:  Cluster\nEvents:                   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拿到这个服务暴露的端口")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NODE_PORT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get services/kubernetes-bootcamp -o go-template"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{(index .spec.ports 0).nodePort}}'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NODE_PORT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NODE_PORT")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NODE_PORT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("31244")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 访问这个服务，会发现被自动均衡负载了")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("minikube "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NODE_PORT")]),s._v("\nHello Kubernetes bootcamp"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Running on: kubernetes-bootcamp-765bf4c7b4-tphzj "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("v")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("minikube "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NODE_PORT")]),s._v("\nHello Kubernetes bootcamp"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Running on: kubernetes-bootcamp-765bf4c7b4-mc5sl "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("v")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("minikube "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NODE_PORT")]),s._v("\nHello Kubernetes bootcamp"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Running on: kubernetes-bootcamp-765bf4c7b4-kvzml "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("v")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里笔者还是不清楚，这里的 minikube ip 是怎么访问到这个服务的")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br")])]),e("h3",{attrs:{id:"缩减"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#缩减"}},[s._v("#")]),s._v(" 缩减")]),s._v(" "),e("p",[s._v("和扩展的时候使用的命令一致")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ kubectl scale deployments/kubernetes-bootcamp --replicas"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\ndeployment.apps/kubernetes-bootcamp scaled\n\n$ kubectl get deployments\nNAME                  READY   UP-TO-DATE   AVAILABLE   AGE\nkubernetes-bootcamp   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("           7m56s\n\n$ kubectl get pods -o wide\nNAME                                   READY   STATUS    RESTARTS   AGE     IP           NODE       NOMINATED NODE   READINESS GATES\nkubernetes-bootcamp-765bf4c7b4-f66cb   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          7m25s   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.8   minikube   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nkubernetes-bootcamp-765bf4c7b4-p27l7   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          7m59s   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.4   minikube   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("h2",{attrs:{id:"更新你的应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#更新你的应用"}},[s._v("#")]),s._v(" 更新你的应用")]),s._v(" "),e("p",[e("strong",[s._v("滚动更新")]),s._v(" 允许通过使用新的实例逐步更新 Pod 实例，零停机进行 Deployment 更新。新的 Pod 将在具有可用资源的节点上进行调度。")]),s._v(" "),e("p",[s._v("滚动更新允许以下操作：")]),s._v(" "),e("ul",[e("li",[s._v("将应用程序从一个环境提升到另一个环境（通过容器镜像更新）")]),s._v(" "),e("li",[s._v("回滚到以前的版本")]),s._v(" "),e("li",[s._v("持续集成和持续交付应用程序，无需停机")])]),s._v(" "),e("h3",{attrs:{id:"更新应用程序的版本"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#更新应用程序的版本"}},[s._v("#")]),s._v(" 更新应用程序的版本")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ kubectl get deployments\nNAME                  READY   UP-TO-DATE   AVAILABLE   AGE\nkubernetes-bootcamp   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/4     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("           9s\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出正在运行的 pod")]),s._v("\n$ kubectl get pods\nNAME                                   READY   STATUS    RESTARTS   AGE\nkubernetes-bootcamp-765bf4c7b4-5dnsj   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          21s\nkubernetes-bootcamp-765bf4c7b4-fhpjw   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          21s\nkubernetes-bootcamp-765bf4c7b4-l2xck   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          21s\nkubernetes-bootcamp-765bf4c7b4-t7f7v   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          21s\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看当前 pod 的image 版本")]),s._v("\n$ kubectl describe pods\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nContainers:\n  kubernetes-bootcamp:\n    Container ID:   docker://27adad6a06a62863b135e6aa1563cb214fa8c5503c746a17c37805566ed31aa2\n    Image:          gcr.io/google-samples/kubernetes-bootcamp:v1   "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主要看这个镜像版本")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br")])]),e("p",[s._v("开始滚动更新")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ kubectl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" image deployments/kubernetes-bootcamp kubernetes-bootcamp"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("jocatalin/kubernetes-bootcamp:v2\ndeployment.apps/kubernetes-bootcamp image updated\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 pod 状态")]),s._v("\n$ kubectl get pods\nNAME                                   READY   STATUS        RESTARTS   AGE\nkubernetes-bootcamp-765bf4c7b4-5dnsj   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     Terminating   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          4m5s\nkubernetes-bootcamp-765bf4c7b4-fhpjw   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     Terminating   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          4m5s\nkubernetes-bootcamp-765bf4c7b4-l2xck   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     Terminating   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          4m5s\nkubernetes-bootcamp-765bf4c7b4-t7f7v   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     Terminating   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          4m5s\nkubernetes-bootcamp-7d6f8694b6-9t5pd   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          38s\nkubernetes-bootcamp-7d6f8694b6-cgljl   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          38s\nkubernetes-bootcamp-7d6f8694b6-h2gtl   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          40s\nkubernetes-bootcamp-7d6f8694b6-k7hkm   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          40s\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以看到有终止状态，等一会，就变成新的 pod 了")]),s._v("\n$ kubectl get pods\nNAME                                   READY   STATUS    RESTARTS   AGE\nkubernetes-bootcamp-7d6f8694b6-9t5pd   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          41s\nkubernetes-bootcamp-7d6f8694b6-cgljl   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          41s\nkubernetes-bootcamp-7d6f8694b6-h2gtl   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          43s\nkubernetes-bootcamp-7d6f8694b6-k7hkm   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          43s\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br")])]),e("h3",{attrs:{id:"验证一个更新"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#验证一个更新"}},[s._v("#")]),s._v(" 验证一个更新")]),s._v(" "),e("p",[s._v("首先，让我们检查应用程序是否正在运行。为了找出暴露的 IP 和端口，我们可以使用描述服务:")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ kubectl describe services/kubernetes-bootcamp\nName:                     kubernetes-bootcamp\nNamespace:                default\nLabels:                   "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("run")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes-bootcamp\nAnnotations:              "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nSelector:                 "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("run")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes-bootcamp\nType:                     NodePort\nIP:                       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.109")]),s._v(".203.10\nPort:                     "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("unset"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/TCP\nTargetPort:               "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/TCP\nNodePort:                 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("unset"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("30410")]),s._v("/TCP\nEndpoints:                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.10:8080,172.18.0.11:8080,172.18.0.12:8080 + "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" more"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nSession Affinity:         None\nExternal Traffic Policy:  Cluster\nEvents:                   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拿到暴露的端口")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NODE_PORT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get services/kubernetes-bootcamp -o go-template"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{(index .spec.ports 0).nodePort}}'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NODE_PORT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NODE_PORT")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NODE_PORT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("30410")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证是否更新")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("minikube "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NODE_PORT")]),s._v("\nHello Kubernetes bootcamp"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Running on: kubernetes-bootcamp-7d6f8694b6-9t5pd "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("v")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("minikube "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NODE_PORT")]),s._v("\nHello Kubernetes bootcamp"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Running on: kubernetes-bootcamp-7d6f8694b6-9t5pd "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("v")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("minikube "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NODE_PORT")]),s._v("\nHello Kubernetes bootcamp"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Running on: kubernetes-bootcamp-7d6f8694b6-h2gtl "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("v")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("minikube "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NODE_PORT")]),s._v("\nHello Kubernetes bootcamp"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Running on: kubernetes-bootcamp-7d6f8694b6-k7hkm "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("v")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br")])]),e("p",[s._v("更新也可以通过运行 rollout 状态命令来确认:")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ kubectl rollout status deployments/kubernetes-bootcamp\ndeployment "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes-bootcamp"')]),s._v(" successfully rolled out\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看当前的镜像版本。使用 describe 命令")]),s._v("\n$ kubectl describe pods\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"回滚更新"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#回滚更新"}},[s._v("#")]),s._v(" 回滚更新")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 先升级部署使用 v10 的镜像")]),s._v("\n$ kubectl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" image deployments/kubernetes-bootcamp kubernetes-bootcamp"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("gcr.io/google-samples/kubernetes-bootcamp:v10\ndeployment.apps/kubernetes-bootcamp image updated\n\n$ kubectl get deployments\nNAME                  READY   UP-TO-DATE   AVAILABLE   AGE\nkubernetes-bootcamp   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/4     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("           11m\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 但是没有达到我们预期的 pod 数量")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看当前的 pods")]),s._v("\n$ kubectl get pods\nNAME                                   READY   STATUS             RESTARTS   AGE\nkubernetes-bootcamp-7d6f8694b6-9t5pd   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          8m41s\nkubernetes-bootcamp-7d6f8694b6-h2gtl   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          8m43s\nkubernetes-bootcamp-7d6f8694b6-k7hkm   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          8m43s\nkubernetes-bootcamp-886577c5d-5kdnv    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     ImagePullBackOff   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          93s\nkubernetes-bootcamp-886577c5d-qpb4g    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     ImagePullBackOff   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          93s\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在描述命令上，能看到更多的 pod 信息")]),s._v("\n$ kubectl describe pods\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". \nWarning  Failed     73s "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x4 over 2m43s"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  kubelet, minikube  Failed to pull image "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gcr.io/google-samples/kubernetes-bootcamp:v10"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" rpc error: code "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Unknown desc "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Error response from daemon: manifest "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" gcr.io/google-samples/kubernetes-bootcamp:v10 not found: manifest unknown: Failed to fetch "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v10"')]),s._v(" from request "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/v2/google-samples/kubernetes-bootcamp/manifests/v10"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通观察，可以发现根本就没有 v10 这个镜像。 上述的 pods 表示有 3 个可用，有 2 个更新失败了")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这意味着，在滚动更新过程中，新的版本启动失败了，老的丢掉了一个")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个时候使用回滚更新")]),s._v("\n$ kubectl rollout undo deployments/kubernetes-bootcamp\ndeployment.apps/kubernetes-bootcamp rolled back\n\n$ kubectl get pods\nNAME                                   READY   STATUS    RESTARTS   AGE\nkubernetes-bootcamp-7d6f8694b6-9b9jb   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          17s\nkubernetes-bootcamp-7d6f8694b6-9t5pd   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          13m\nkubernetes-bootcamp-7d6f8694b6-h2gtl   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          13m\nkubernetes-bootcamp-7d6f8694b6-k7hkm   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          13m\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 就会发现，死掉的哪一个又活过来了")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);