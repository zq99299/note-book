(window.webpackJsonp=window.webpackJsonp||[]).push([[183],{1708:function(e,s,a){"use strict";a.r(s);var t=a(13),r=Object(t.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"_185-商品详情页动态渲染系统-所有服务最终修改以及-jenkins-docker-部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_185-商品详情页动态渲染系统-所有服务最终修改以及-jenkins-docker-部署"}},[e._v("#")]),e._v(" 185. 商品详情页动态渲染系统：所有服务最终修改以及 jenkins+docker 部署")]),e._v(" "),t("p",[e._v("本章不部署所有的了，前面使用 jenkins + docker 部署了一个服务，\n其他的服务也是类似的构建步骤，只是需要把其中的各种数据库等都写生产环境的 ip 地址，就可以了。")]),e._v(" "),t("p",[e._v("本次要实现这些部署，可能要耗费大量的时间，就不实践了")]),e._v(" "),t("p",[e._v("查看某个容器运行的日志：")]),e._v(" "),t("h2",{attrs:{id:"查看-docker-容器应用日志-logs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看-docker-容器应用日志-logs"}},[e._v("#")]),e._v(" 查看 docker 容器应用日志 logs")]),e._v(" "),t("p",[e._v("语法："),t("code",[e._v("docker logs -f -t --tail 行数 容器名")])]),e._v(" "),t("p",[e._v("比如："),t("code",[e._v('docker logs --tail="100" eshop-eureka-server')]),e._v(" 获取容器运行后 100 行的文件内容（文件末尾）")]),e._v(" "),t("h2",{attrs:{id:"查看-docker-容器应用日志-inspect"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看-docker-容器应用日志-inspect"}},[e._v("#")]),e._v(" 查看 docker 容器应用日志 inspect")]),e._v(" "),t("p",[e._v("通过查看某个镜像 CONTAINER ID 的详细信息")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('[root@localhost eshop-eureka-server]# docker ps -a\nCONTAINER ID        IMAGE                                                       COMMAND                  CREATED             STATUS                  PORTS                    NAMES\n45f7ac13c9c5        192.168.99.20:2375/eshop-detail/eshop-eureka-server:1.0.0   "java -Djava.securit…"   34 minutes ago      Up 34 minutes           0.0.0.0:8761->8761/tcp   eshop-eureka-server\n27783f1b4c9f        hello-world                                                 "/hello"                 3 days ago          Exited (0) 3 days ago                            stupefied_matsumoto\n[root@localhost eshop-eureka-server]# docker inspect 45f7ac13c9c5\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br")])]),t("p",[e._v("在详细信息中找到 LogPath : "),t("code",[e._v('"LogPath": "/var/lib/docker/containers/45f7ac13c9c5d963489f9de09262258950a7b3dcf5a4b91d3eadbefae890c7fc/45f7ac13c9c5d963489f9de09262258950a7b3dcf5a4b91d3eadbefae890c7fc-json.log",')]),e._v("，这个路径则是宿主机上的物理文件路径，里面就是存放的日志，可以直接查看，比如")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('[root@localhost eshop-eureka-server]# tail -f /var/lib/docker/containers/45f7ac13c9c5d963489f9de09262258950a7b3dcf5a4b91d3eadbefae890c7fc/45f7ac13c9c5d963489f9de09262258950a7b3dcf5a4b91d3eadbefae890c7fc-json.log\n{"log":"2019-09-22 15:44:12.581  INFO 1 --- [a-EvictionTimer] c.n.e.registry.AbstractInstanceRegistry  : Running the evict task with compensationTime 0ms\\n","stream":"stdout","time":"2019-09-22T15:44:12.582373481Z"}\n{"log":"2019-09-22 15:45:12.581  INFO 1 --- [a-EvictionTimer] c.n.e.registry.AbstractInstanceRegistry  : Running the evict task with compensationTime 0ms\\n","stream":"stdout","time":"2019-09-22T15:45:12.582319173Z"}\n{"log":"2019-09-22 15:46:12.581  INFO 1 --- [a-EvictionTimer] c.n.e.registry.AbstractInstanceRegistry  : Running the evict task with compensationTime 0ms\\n","stream":"stdout","time":"2019-09-22T15:46:12.581907101Z"}\n\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br")])]),t("h2",{attrs:{id:"docker-运行后的-host-name-问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-运行后的-host-name-问题"}},[e._v("#")]),e._v(" docker 运行后的 host name 问题")]),e._v(" "),t("p",[e._v("需要添加 "),t("code",[e._v('--network="host"')]),e._v("，参数，host 网络模式，所有容器端口都对应属主机端口，不存在映射关系。")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('docker run -d -p 8767:8767 --network="host" --name ${PROJECT_NAME} ${REGISTRY_URL}/eshop-detail/${PROJECT_NAME}:${PROJECT_VERSION}\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("下图展示了用 host 与不用 host 注册到 eureka 的区别")]),e._v(" "),t("p",[t("img",{attrs:{src:a(489),alt:""}})])])}),[],!1,null,null,null);s.default=r.exports},489:function(e,s,a){e.exports=a.p+"assets/img/markdown-img-paste-20190925234417327.74e39122.png"}}]);